<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alfred</title>

    <!-- Bulma.io CSS Framework -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.0.26/css/bulma.min.css">

    <!-- Font awesome CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='font-awesome/css/font-awesome.min.css') }}">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">

    <!-- Balloon.css library for css tooltips -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/balloon-css/0.2.4/balloon.min.css">

    <!-- Javascript functions -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/js-functions.js') }}"></script>

</head>

<body>
<div class="container is-fluid">

    <!-- Login modal -->
    {% include "login.html" %}

    <!-- Delete account modal -->
    {% include "delete_account.html" %}

    <!-- Modal to display when Alfred is "thinking" (retrieving recipes) -->
    {% include "thinking_alfred.html" %}

    <!-- Invisible audio player -->
    {% if wavfile %}
        <audio autoplay src="data:audio/wav;base64,{{ wavfile }}">
            Your browser does not support this audio format.
        </audio>
    {% endif %}


    <!-- Header -->
    {% include 'header.html' %}

    <!-- Flashed messages by category -->
    <!-- is-danger = error, is-success = green, is-info = blue -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {# % for category, message in messages %#}
            {#  Getting duplicate GET requests on some attempts to confirm email.
                    this also triggers duplicate flash messages. Because so far the application
                    has no need to send more than one message this is ok. Investigate in the future
                    though.
                    Update: When I hover over/select a confirmation link in chrome browser,
                    the browser sends some sort of request before I actually click it. #}
            <div class="columns">
                <div class="column has-text-centered">
                    <article class="message {{ messages[0][0] }}">
                        <div class="message-body"> {{ messages[0][1] }}</div>
                    </article>
                </div>
            </div>
            {#% endfor %#}
        {% endif %}
    {% endwith %}

    <!-- Fullscreen Content -->
    {% block fullscreen %}

        <div class="container is-fluid">

            <!-- Column Section-->
            <div class="columns">

                <!-- Left 1/4 of screen -->
                <div class="column is-one-quarter">

                    <h3 class="title is-3">Recipes</h3>
                    {% for recipe in recipe_suggestions %}
                        <p><a href="/search?recipe_name={{ recipe.title|urlencode }}">
                            {{ recipe.title }}
                        </a></p>
                    {% endfor %}

                </div>

                <!-- Right 3/4 of screen -->
                <div class="column is-three-quarters">

                    <div class="recipe_list">
                        {% block content %}
                        {% endblock %}
                    </div>
                </div>

            </div>

        </div>
    {% endblock %}

</div>

<!-- Leave enough space to compensate for footer (show all recipes) -->
<div class="" style="margin-bottom: 120px;"></div>

<!-- Footer -->
<div class="custom_footer">

    <!-- Alfred image -->
    <img class="is-pulled-left alfred_image"
         src="{{ url_for('static', filename='images/alfred2.png') }}"
         onmouseenter='show_alfred_tooltip();'
         onmouseout='hide_alfred_tooltip();'>


    <div class="alfred_input">
        <p class="control">
            <label class="label is-marginless is-pulled-left"
                   style="font-size: 18px; font-weight: normal;">Ingredients/Keywords:</label><br>
        </p>

        <!-- Alfred input box -->
        <form action="/search_keywords" method="POST">
            <div class="control is-grouped is-dark">
                <p class="control is-expanded">
                    {% if ingredient_list %}
                        <input class="input alfred_input_text is-success"
                               name="keywords"
                               value="{{ ingredient_list }}">
                    {% else %}
                        <input class="input alfred_input_text is-success" name="keywords">
                    {% endif %}
                </p>

                <p class="control">
                    <button class="button is-success is-outlined alfred_search_button">Search</button>
                </p>
            </div>
        </form>
    </div>

    <!-- Siri wave div -->
    <div id="siri-container" class="has-text-centered siri_wave grad">
    </div>

    <!-- Alfred tex div -->
    <div class="alfred_text_div" id="text_div">
        <p class="subtitle">
        </p>
    </div>

</div>


<!-- Siri wave generator library -->
<script type="text/javascript" src="{{ url_for('static', filename='js/siriwave.js') }}"></script>

<!-- Microphone recorder functions -->
<script type="text/javascript" src="{{ url_for('static', filename='js/recorder.js') }}"></script>

<!-- Set event to generate random values for Siri wave -->
<script type="text/javascript">
    var x = setInterval(
            function () {
                var noise = Math.random() * 1;
                //SW.setNoise( noise );
                var amplitude = Math.random();
                SW.setAmplitude(amplitude);
                var speed = ( (Math.random() ) / 10) + 0.1;
                //SW.setSpeed(speed);
                //console.log(speed);
                //SW.frequency = (Math.random() * 10 ) + 5;
            }, 250
    );
</script>

<!-- Init siri wave container -->
<script type="text/javascript">
    var $siri_classic = document.getElementById('siri-container');
    var SW = new SiriWave({
        style: 'ios9',
        color: '#000',
        width: 370,
        height: 80,
        speed: 0.12,
        amplitude: 1,
        container: document.getElementById('siri-container'),
        autostart: false
    });
</script>

</body>
</html>
