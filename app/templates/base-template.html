<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alfred</title>

    <!-- Bulma.io CSS Framework -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.0.26/css/bulma.min.css">

    <!-- Font awesome CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='font-awesome/css/font-awesome.min.css') }}">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">

    <!-- Balloon.css library for css tooltips -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/balloon-css/0.2.4/balloon.min.css">

</head>

<body>
<div class="container is-fluid">

    <!-- Login modal -->
    {% include "login.html" %}

    <!-- Delete account modal -->
    {% include "delete_account.html" %}

    <!-- Modal to display when Alfred is "thinking" (retrieving recipes) -->
    {% include "thinking_alfred.html" %}

    <!-- Invisible audio player -->
    {% if wavfile %}
        <audio autoplay src="data:audio/wav;base64,{{ wavfile }}">
            Your browser does not support this audio format.
        </audio>
    {% endif %}


    <!-- Header -->
    {% include 'header.html' %}

    <!-- Flashed messages by category -->
    <!-- is-danger = error, is-success = green, is-info = blue -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {# % for category, message in messages %#}
            {#  Getting duplicate GET requests on some attempts to confirm email.
                this also triggers duplicate flash messages. Because so far the application
                has no need to send more than one message this is ok. Investigate in the future
                though.
                Update: When I hover over/select a confirmation link in chrome browser,
                the browser sends some sort of request before I actually click it. #}
            <div class="columns">
                <div class="column has-text-centered">
                    <article class="message {{ messages[0][0] }}">
                        <div class="message-body"> {{ messages[0][1] }}</div>
                    </article>
                </div>
            </div>
            {#% endfor %#}
        {% endif %}
    {% endwith %}

    <!-- Fullscreen Content -->
    {% block fullscreen %}

        <!-- Column Section-->
        <div class="columns">

            <!-- Left 1/4 of screen -->
            <div class="column is-one-quarter">

                <h3 class="title is-3">Recipes</h3>
                {% for recipe in recipe_suggestions %}
                    <p><a href="/search?recipe_name={{ recipe.title|urlencode }}">
                        {{ recipe.title }}
                    </a></p>
                {% endfor %}

            </div>

            <!-- Right 3/4 of screen -->
            <div class="column is-three-quarters">

                <div class="recipe_list">
                    {% block content %}
                    {% endblock %}
                </div>
            </div>

        </div>

    {% endblock %}

</div>

<!-- Microphone recorder functions -->
<div class="tooltip">

    <span class="tooltiptext">Click Alfred to start speaking<br>Click again to when finished speaking</span>
</div>


<!-- Footer -->
<div class="custom_footer">
    <a>
        <img src="{{ url_for('static', filename='images/alfred2.png') }}" class="microphone">
    </a>

    <div id="siri-container" class="has-text-centered" style="margin: auto;"></div>
</div>



<script src="{{ url_for('static', filename='js/recorder.js') }}"></script>

<!-- Javascript functions -->
<script src="{{ url_for('static', filename='js/js-functions.js') }}"></script>

<!-- Siri wave generator library -->
<script src="{{ url_for('static', filename='js/siriwave.js') }}"></script>


<!-- Set event to generate random values for Siri wave -->
<script>
    var x = setInterval(
            function () {
                //SW.setNoise(  );
                var amplitude = Math.random() * 2;
                SW.setAmplitude(amplitude);
                var speed = ( (Math.random() ) / 10) + 0.1;
                SW.setSpeed(speed);
                //console.log(speed);
                //SW.frequency = (Math.random() * 10 ) + 5;
            }, 500
    );
</script>

<!-- Init siri wave container -->
<script>
    var $siri_classic = document.getElementById('siri-container');
    var SW = new SiriWave({
        color: '#000',
        //width: 259,
        //height: 90,
        speed: 0.12,
        amplitude: 0.5,
        container: $siri_classic,
        autostart: false
    });
</script>

</body>
</html>
